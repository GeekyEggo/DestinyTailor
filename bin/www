#!/usr/bin/env node

var app = require('../server/main'),
    config = require('../server/config'),
    debug = require('debug')('DestinyTailor:server'),
    http = require('http');

// set the port and start the server
app.set('port', config.port);
var server = http.createServer(app);

/**
 * Handles the server listening on the port.
 */
server.listen(config.port, function() {
    console.log('Express server listening on port ' + config.port);
});

/**
 * Handle any errors when starting the server.
 * @param {Object} error The error.
 */
server.on('error', function(error) {
  if (error.syscall !== 'listen') {
      throw error;
  }

  // handle specific listen errors with friendly messages
  switch (error.code) {
      case 'EACCES':
          console.error('Port: ' + config.port + ' requires elevated privileges');
          process.exit(1);
      break;
      case 'EADDRINUSE':
          console.error('Port: ' + config.port + ' is already in use');
          process.exit(1);
      break;
      default:
          throw error;
      };
});
